@using Carnesia.Domain.WMS.BinDetails
@using Carnesia.Domain.WMS.BinInscan
@inject IPutAway _putAway
@inject ISnackbar _snackbar

<MudPaper Class="px-16 pb-16 pt-10 ma-2 mt-10">
    <MudContainer Fixed="true">
        <MudText Typo="Typo.h3">F4R1C1RA1B11</MudText>
        <MudText>Total: 13</MudText>
        <MudGrid Class="justify-center align-baseline mb-5">
            <MudItem md="3">
                <MudTextField T="string" @bind-Value="Bin" Label="Bin Number" Variant="Variant.Text" />
            </MudItem>
            <MudItem md="3">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="GetBinDetails">Filter</MudButton>
            </MudItem>
        </MudGrid>

        <MudTable Items="@Elements" Hover="true">
            <HeaderContent>
                <MudTh>Product Code</MudTh>
                <MudTh>SKU</MudTh>
                <MudTh>Item Code</MudTh>
                <MudTh>Product Code</MudTh>
                <MudTh>Product Name</MudTh>
                <MudTh>QTY</MudTh>
                <MudTh>BIN</MudTh>
                <MudTh>Expiry Date</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Product Code">@context.ProductCode</MudTd>
                <MudTd DataLabel="SKU">@context.sku</MudTd>
                <MudTd DataLabel="Product Name">@context.binName</MudTd>
                <MudTd DataLabel="QTY">@context.binSKUStockQty</MudTd>
                <MudTd DataLabel="BIN">@context.binName</MudTd>
                <MudTd DataLabel="Expiry Date">
                    <MudButton Color="Color.Primary">View</MudButton>
                </MudTd>
                <MudTd DataLabel="Item Code">@context.sku</MudTd>
                <MudTd DataLabel="Product Name">@context.ProductCode</MudTd>
                <MudTd DataLabel="Product Name">@context.productName</MudTd>
                <MudTd DataLabel="QTY">@context.binSKUStockQty</MudTd>
                <MudTd DataLabel="BIN">@context.binName</MudTd>
                <MudTd DataLabel="Download CSV">
                    <MudButton Color="Color.Primary">Download CSV</MudButton>
                </MudTd>
            </RowTemplate>
        </MudTable>
    </MudContainer>
</MudPaper>

@code {
    public string Bin { get; set; }
    // Table Content
    private List<BinProductDetails> Elements = new List<BinProductDetails>();

    private async Task GetBinDetails()
    {
        try
        {
            Elements.Clear();
            var result = await _putAway.BinDetails(Bin);
            Elements = result.binDetails;
        }
        catch (Exception e)
        {
            _snackbar.Add("Error from database", Severity.Error);
            //Console.WriteLine(e);
            //throw;
        }
    }
}
